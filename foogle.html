<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Foogle</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
<div id="main">
</div>
</body>


<template id="result_item">
<div>
<a href="#" onclick="click_link(this)"></a>
<br>
<p>
</div>
</template>

<template id="homepage">
<button onclick="click_back()">Back</button>
<input type="search">
<button onclick="click_go()">Go</button>
<article></article>
</template>

<template id="webpage">
<h1></h1>
<article></article>
</template>

  <script>
  var main_hist = [];
  if ("content" in document.createElement("template")) {
  const body = document.querySelector("body");
  const main = document.querySelector("#main");
  const homepage = document.querySelector("#homepage");
  const result_item = document.querySelector("#result_item");
  const clone = homepage.content.cloneNode(true);
  body.insertBefore(clone, main);
  }
  
  function click_go() {
    var OPENROUTER_API_KEY = "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";
    const search_term = document.querySelector("input").value;
    fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        "model": "qwen/qwen-2-7b-instruct:free",
        "messages": [
          {"role": "user", "content": `Give me a list of 20 websites that might be useful for answering my query along with a short description of each website. Print the title of each website, newline, the description of that website, newline, and so on. Print nothing else, don't say Description or anything like that. The query is: ${search_term}`},
        ],
      })
    }).then(res => {
      console.log(res);
      return res.text();
    }).then(res => {
      console.log(res);
      const titles = JSON.parse(res).choices[0].message.content.split(new RegExp('\n+'));
      
      const main = document.querySelector("#main");
      main.innerHTML = '';
      
      for (let i = 0; i < titles.length/2; i += 2) {
        let item = result_item.content.cloneNode(true);
        item.querySelector("a").innerText = titles[i];
        item.querySelector("p").innerText = titles[i+1];
        main.appendChild(item);
      }
    });
  }
  
  function click_link(event) {
    console.log(event);
    const title = event.textContent;
    console.log(title);
    const description = event.nextElementSibling.nextElementSibling.textContent;
    console.log(description);
    const main = document.querySelector("#main");
    let webpage = document.querySelector("#webpage").content.cloneNode(true);
    
    var OPENROUTER_API_KEY = "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";
    const search_term = document.querySelector("input").value;
    fetch("https://openrouter.ai/api/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        "model": "qwen/qwen-2-7b-instruct:free",
        "messages": [
          {"role": "user", "content": `Give me the content for a website based on the title and description of the website. The content should only include basic HTML tags, and should never include the 'body' or 'html' tags. The title is: ${title}. And the description is: ${description}.`},
        ],
      })
    }).then(res => {
      console.log(res);
      return res.text();
    }).then(res => {      
      const website_body = JSON.parse(res).choices[0].message.content;
      //console.log(webpage);
      webpage.querySelector("h1").innerText = title;
      webpage.querySelector("article").innerHTML = website_body;
      main_hist.push(main.innerHTML);
      main.innerHTML = '';
      main.appendChild(webpage);
    });
  }
  
  function click_back() {
    main.innerHTML = '';
    main.innerHTML = main_hist.pop();
  }
  </script>
</html>
